# azure-pipelines.yml

#variables:
#  CLOUD_MANAGER_CREDENTIALS: $(CLOUD_MANAGER_CREDENTIALS)

trigger:
  branches:
    include:
      - main  # Replace with your desired branch or use '*' to include all branches

pr: none  # Disabling Pull Request triggers for simplicity. You can enable it if needed.

pool:
  vmImage: 'ubuntu-latest'  # Use an appropriate image for your script (Windows, macOS, etc.)

steps:
- script: |
    # Check out the 'main' branch of the current repository
    git config --global user.email "azure-pipelines@noreply.com"
    git config --global user.name "Azure Pipelines"
    git config --global init.defaultBranch origin/main
    git fetch origin
    git checkout origin/main
  displayName: 'Checkout main branch'

- script: |
    TARGET_GIT="https://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@github.com/mayurb-org/aem-devops.git"
    
    git checkout origin/main
    git branch -l
    #git branch -M main

    # Set up the adobe repository as a remote
    git remote add adobe ${TARGET_GIT}

    # Fetch and pull changes from the source repository
    git fetch origin
    git pull origin main

    # Push changes to the target repository
    git push -f -v adobe main

  displayName: 'Sync Source to Target Repository'

